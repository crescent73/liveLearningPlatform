<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
	<title>公开课列表 - 慕学在线网</title>
	<link rel="stylesheet" type="text/css" href="/css/reset.css">
	<link rel="stylesheet" type="text/css" href="/css/animate.css">
	<link rel="stylesheet" type="text/css" href="/css/style.css">
	
    <link rel="stylesheet" type="text/css" href="/css/muke/course/learn-less.css" />
	<link rel="stylesheet" type="text/css" href="/css/muke/course/course-comment.css" />
    <link rel="stylesheet" type="text/css" href="/css/muke/base.css">
    <link rel="stylesheet" type="text/css" href="/css/muke/common-less.css">
    <link rel="stylesheet" type="text/css" href="/css/muke/course/common-less.css">
    <link rel="stylesheet" type="text/css" href="/css/mooc.css" />
    
    <script src="/js/jquery.min.js" type="text/javascript"></script>
    <!--<script src="/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>-->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
   <!-- <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>-->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>




</head>
<body >
<section id="course_detail">
<section class="headerwrap wrapper" >
    <header>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container-fluid" class="container" >
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">爱课网</a>
                </div>
                <ul class="nav navbar-nav navbar-right" >
                    <li class="dropdown" v-if="userRole==2">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <span class="glyphicon glyphicon-user" >老师·{{userNickname}}</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="usercenter-info-teacher.html">个人中心</a></li>
                            <li><a @click="logout()">退出</a></li>
                        </ul>
                    </li>
                    <li class="dropdown" v-if="userRole==3">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <span class="glyphicon glyphicon-user" >学生·{{userNickname}}</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="usercenter-info.html">个人中心</a></li>
                            <li><a @click="logout()">退出</a></li>
                        </ul>
                    </li>
                </ul>



            </div>
        </nav>

    </header>
</section>
<!--crumbs start-->

<section>
	<div class="wp">
		<div class="crumbs">
			<ul>
				<li><a href="main.html">首页</a>></li>
                <li><a href="">公开课程</a></li>
			</ul>
		</div>
	</div>
</section>


<section>
	<div class="wp">
		<div class="groupPurchase_detail detail">
			<div class="toppro">
				<div class="left">
					<div class="picbox">
						<div class="tb-booth tb-pic">
							<img width="440" height="445" :src="imageSrc" class="jqzoom" />
						</div>
					</div>

					<div class="des">
						<h1 >{{course.courseName}}</h1>
						<span class="key">{{course.courseDetail}}</span>
						<div class="prize">
							<span class="fl">难度：<i class="key">{{course.courseLevel}}</i></span><br>
						</div>
                        <div>
                            <ul class="parameter">
                                <li><span class="pram word3">课程类别：<i>{{course.courseType}}</i></span><br></li>
                                <li> <span class="pram word3">授课教师：<i >{{course.teacherName}}</i></span><br></li>
                                <li class="btn colectgroupbtn"  id="jsLeftBtn" v-on:click="addFavCourse()">收藏</li>
                                <li class="buy btn"><a style="color: white" href="">开始学习</a></li>
                            </ul>

                        </div>

					</div>


				</div>

			</div>
		</div>
	</div>

	<div class="course-info-main clearfix w has-progress">

        <div class="info-bar clearfix">
            <div class="content-wrap clearfix">
                <div class="content">
                    <div class="mod-tab-menu">
                        <ul class="course-menu clearfix">
                            <li><a  class="active" ><span>评论区</span></a></li>
                        </ul>
                    </div>

                    <!--发布评论-->
                    <div id="js-pub-container" class="issques clearfix js-form">
                        <div class="wgt-ipt-wrap pub-editor-wrap " id="js-pl-input-fake">
                            <textarea  class="" placeholder="扯淡、吐槽、表扬、鼓励……想说啥就说啥！" id="content"></textarea>
                        </div>
                        <input type="button" id="js-pl-submit" class="pub-btn" data-cid="452" value="发表评论" v-on:click="addComment()">
                        <p class="global-errortip js-global-error"></p>
                    </div>

                    <div id="course_note" v-for="comment in commentList">
                        <ul class="mod-post" id="comment-list" >
                            
                            <li class="post-row">
                                <div class="bd">
                                    <div class="tit" align="left">
                                        <span target="_blank" style="font-weight: bold;">{{comment.userNickname}}</span>
                                    </div>
                                    <p class="cnt">{{comment.commentContent}}</p>
                                    <div class="footer clearfix">
                                        <span title="创建时间" class="l timeago">{{comment.publishTime | formatDate}}</span>
                                    </div>
                                    <div class="buy btn" data-favid="14" align="right" style="font-size: 15px" v-on:click="deleteComment(comment)"><a style="color: grey">删除</a></div>
                                </div>
                            </li>

                        </ul>
                    </div>

                </div>

            </div>

        </div>

    </div>
</section>
</section>




<script src="/js/vue.js"></script>
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<!-- jQuery -->
<script src="/js/request.js"></script>
<script src="/js/jquerySession.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script><!-- Bootstrap 4 -->
<script src="/js/adminlte.min.js"></script><!-- AdminLTE App -->
<script src="/js/bs-custom-file-input.min.js"></script><!-- bs-custom-file-input -->
<script src="/js/sweetalert2.min.js"></script>
<script src="/js/requestParam.js"></script>

<script>
    var comment = new Vue({
        el: '#course_detail',
        data:{

                logoutData:{
                    id:null,
                    userType:null
                },
                isTeacher:false,
                userName:null,
                courseName:null,
                courseId:"",

                userEmail: "",
                original_password: "",
                is_old_valid: true,
                retype_password: "",
                is_retype_valid: true,
                password: "",
                is_password_valid: true,
                userNumber: "",
                userRole: "",
                userId: "",
                userNickname:"",
                userGender:"",


                commentList:[],
                course:[],
                imageSrc:""

        },
        methods: {
            getCourseImage(){
                let that = this;
                $.ajax({
                    type: "POST",
                    url:"/teacher/getCourseImage",
                    responseType: 'blob',
                    data:{
                        courseId: that.courseId,
                    },
                    xhr:function(){// Seems like the only way to get access to the xhr object
                        var xhr = new XMLHttpRequest();
                        xhr.responseType= 'blob'
                        return xhr;
                    },
                    success(res) {
                        console.log(res)
                        var url = window.URL || window.webkitURL;
                        that.imageSrc = url.createObjectURL(res);
                    },
                    error(res){
                        console.log(res)
                    }
                });
            },

            getCommentList(){
                let that = this;
                $.ajax({
                    type: "POST",
                    url:"/teacher/getCommentList",
                    data:{
                        'courseId':that.courseId,
                    },
                    success(res) {
                        console.log(res)
                        that.commentList = res.data;
                        // console.log(this.noticeList)
                    },
                    error(res){
                        console.log(res)
                    }

                });
            },

            addComment(){
                let that = this;
                var content = $("#content").val();
                $.ajax({
                    type:'POST',
                    url:'/teacher/addComment',
                    data:{
                        'courseId':that.courseId,
                        'userId':that.userId,
                        'commentContent':content
                    },
                    success(res) {
                        console.log(res)
                        if(res.code==200)
                        {
                            alert("添加成功！");
                            location.reload();
                        }
                        else{
                            alert(res.data.msg);
                            location.reload();
                        }
                        //that.noticeList = res.data;
                        // console.log(this.noticeList)
                    },
                    error(res){
                        console.log(res)
                    }

                })
            },

            deleteComment(comment){
                let that = this;
                $.ajax({
                    type:'POST',
                    url:'/teacher/deleteComment',
                    data:{
                        'commentId':comment.commentId
                    },
                    success(res) {
                        console.log(res)
                        //that.noticeList = res.data;
                        // console.log(this.noticeList)
                        if (res.code == 210) {
                            alert("删除失败！");
                            location.reload();
                        } else {
                            alert("删除成功！");
                            location.reload();
                        }
                    },
                    error(res) {
                        console.log(res)
                    }
                })

            },

            getCourseList(){
                let that = this;
                $.ajax({
                    type: "POST",
                    url:"/teacher/searchCourse",
                    data:{
                        'courseId': that.courseId
                    },
                    success(res) {
                        console.log(res);
                        that.course = res.data[0];

                    },
                    error(res){
                        console.log(res)
                    }

                });
            },

            addFavCourse(){
              let that = this;
              $.ajax({
                  type:"POST",
                  url:"/teacher/addCollectCourse",
                  data:{
                      'courseId':that.courseId,
                      'userId':that.userId,
                  },
                  success(res) {
                      console.log(res);
                      if (res.code == 200) {
                          alert("插入成功！");
                          if(that.userRole==3){
                              window.location.href="usercenter-fav-course.html";
                          }
                          else if(that.userRole==2){
                              window.location.href="usercenter-fav-course-teacher.html";
                          }

                      } else {
                          alert(res.data.msg);
                      }

                  },
                  error(res){
                      console.log(res)
                  }
              })
            },


            init(type){
                let that = this;
                console.log(type);
                switch(type){
                    case "2"://教师
                        that.logoutData.id = localStorage.getItem("userId");
                        that.logoutData.userType = localStorage.getItem("userRole");
                        that.isTeacher = true;
                        break;
                    case "3"://学生
                        that.logoutData.id = localStorage.getItem("userId");
                        that.logoutData.userType = localStorage.getItem("userRole");
                        that.isTeacher = false;
                        break;
                    case "1":
                        //window.location.href = requestHref.login;//跳转到登陆页面
                        break;
                    default:
                        //window.location.href = requestHref.login;//跳转到登陆页面
                }
            },

            logout(){
                let that = this;
                request({
                    type:requestType.post,
                    url:requestUrl.logout,
                    data:this.logoutData,
                }).then(
                    function success(res){
                        localStorage.clear();
                        console.log(res);
                        console.log(res.code);
                        window.location.href="/blackboard/";
                    },
                    function error(res){
                        console.log(res)
                    }
                );
            },

        },
        filters: {
            formatDate: function (value) {
                let date = new Date(value);
                let y = date.getFullYear();
                let MM = date.getMonth() + 1;
                MM = MM < 10 ? ('0' + MM) : MM;
                let d = date.getDate();
                d = d < 10 ? ('0' + d) : d;
                let h = date.getHours();
                h = h < 10 ? ('0' + h) : h;
                let m = date.getMinutes();
                m = m < 10 ? ('0' + m) : m;
                let s = date.getSeconds();
                s = s < 10 ? ('0' + s) : s;
                return y + '-' + MM + '-' + d + ' ' + h + ':' + m + ':' + s;
            }

        },
        created(){
            this.init(localStorage.getItem("userRole"));
        },
        mounted() {
            this.userName = localStorage.getItem("userName");
            this.userEmail = localStorage.getItem("userEmail");
            this.userNumber = localStorage.getItem("userNumber");
            this.userNickname = localStorage.getItem("userNickname");
            this.userRole = localStorage.getItem("userRole");
            this.userId = parseInt(localStorage.getItem("userId"));
            this.userPassword=localStorage.getItem("userPassword");
            this.userGender=localStorage.getItem("userGender");
            this.schoolId= parseInt(localStorage.getItem("schoolId"));

            this.courseId=parseInt(localStorage.getItem("courseId"));

            this.getCourseList();
            this.getCommentList();
            this.getCourseImage();
        },
        watch: {
            original_password: function (value, old) {
                this.is_old_valid = !(this.original_password === "" || this.original_password === undefined || this.original_password === null);
            },
            password: function (value, old) {
                this.is_password_valid = !(this.password === "" || this.password === undefined || this.password === null);
            },
            retype_password: function (value, old) {
                this.is_retype_valid = !(this.retype_password === "" || this.retype_password === undefined || this.retype_password === null)
            }
        }

    });
</script>



</body>
</html>
